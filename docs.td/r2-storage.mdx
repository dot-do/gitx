---
title: R2 Storage
description: Packfile management for Cloudflare R2 object storage
---

The R2 storage module provides packfile management optimized for Cloudflare R2. Store, retrieve, and index packfiles with built-in verification and multi-pack index support.

## Setup

```typescript
import { R2PackStorage } from 'gitx.do/storage/r2-pack'

const storage = new R2PackStorage({
  bucket,
  prefix: 'repos/my-repo/'
})
```

## Uploading Packfiles

Store a packfile with its index:

```typescript
const result = await storage.uploadPackfile(packData, indexData)
console.log(`Uploaded pack: ${result.packId}`)
```

## Downloading Packfiles

Retrieve packfiles with optional integrity verification:

```typescript
const pack = await storage.downloadPackfile(packId, {
  verify: true
})
```

## Multi-Pack Index

Build and use a multi-pack index for efficient cross-pack lookups:

```typescript
// Rebuild the index after adding packs
await storage.rebuildMultiPackIndex()

// Use the index for lookups
const midx = await storage.getMultiPackIndex()
const location = midx.findObject(sha)
```

## API Reference

| Method | Description |
|--------|-------------|
| `uploadPackfile(pack, index)` | Store pack and index |
| `downloadPackfile(id, options)` | Retrieve with optional verification |
| `rebuildMultiPackIndex()` | Build cross-pack index |
| `getMultiPackIndex()` | Get the multi-pack index |
| `createMultiPackIndex()` | Build cross-pack index (static) |
